---
layout: post
title: study180524
---

<h3> Activity를 Start하는 과정 4</h3>

저번주까지 다루었던 Activity를 시작하기 전에 수행하는 전처리 과정을 다 거치고 나면, startActivityUnchecked 메소드를 통해 Activity를 Start한다.

~~~
// Note: This method should only be called from {@link startActivity}.
private int startActivityUnchecked(final ActivityRecord r, ActivityRecord sourceRecord,
        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
        int startFlags, boolean doResume, ActivityOptions options, TaskRecord inTask,
        ActivityRecord[] outActivity) {

    setInitialState(r, options, inTask, doResume, startFlags, sourceRecord, voiceSession,
            voiceInteractor);

    computeLaunchingTaskFlags();

    computeSourceStack();

    mIntent.setFlags(mLaunchFlags);
~~~

먼저 초기 상태를 setInitialState를 통해 설정하는데, 여기서 말하는 초기 상태는 ActivityStarter 클래스 내의 메소드들에서 start하는 Activity의 상태를 공유하기 위해 선언해놓은 멤버 변수들을 칭한다.

~~~
    // Share state variable among methods when starting an activity.
    private ActivityRecord mStartActivity;
    private Intent mIntent;
    private int mCallingUid;
    private ActivityOptions mOptions;

    private boolean mLaunchSingleTop;
    private boolean mLaunchSingleInstance;
    private boolean mLaunchSingleTask;
    private boolean mLaunchTaskBehind;
    private int mLaunchFlags;

    private Rect mLaunchBounds;

    private ActivityRecord mNotTop;
    private boolean mDoResume;
    private int mStartFlags;
    private ActivityRecord mSourceRecord;
    private int mSourceDisplayId;

    private TaskRecord mInTask;
    private boolean mAddingToTask;
    private TaskRecord mReuseTask;

    private ActivityInfo mNewTaskInfo;
    private Intent mNewTaskIntent;
    private ActivityStack mSourceStack;
    private ActivityStack mTargetStack;
    // Indicates that we moved other task and are going to put something on top soon, so
    // we don't want to show it redundantly or accidentally change what's shown below.
    private boolean mMovedOtherTask;
    private boolean mMovedToFront;
    private boolean mNoAnimation;
    private boolean mKeepCurTransition;
    private boolean mAvoidMoveToFront;
    private boolean mPowerHintSent;

    // We must track when we deliver the new intent since multiple code paths invoke
    // {@link #deliverNewIntent}. This is due to early returns in the code path. This flag is used
    // inside {@link #deliverNewIntent} to suppress duplicate requests and ensure the intent is
    // delivered at most once.
    private boolean mIntentDelivered;

    private IVoiceInteractionSession mVoiceSession;
    private IVoiceInteractor mVoiceInteractor;

    private boolean mUsingVr2dDisplay;
~~~

초기 상태들의 값을 설정하고 나면, computeLaunchingTaskFlags를 이용하여 LaunchMode라고 하는 개발자가 정한 Flag를 확인하고 그에 대한 처리를 수행한다. LaunchMode에 대한 내용은 다른 팀원이 자세하게 다룬 것이 있다. [링크](https://dhfkfl1.github.io/dhfkfl1.github.io/2018/05/17/Android-_FLAG_ACTIVITY.html)

* * *
