---
layout: post
title: study180720
---

<h3>ActivityStarter를 다시 보자...</h3>

멘토님을 만났을 때 정했던 방향대로, ActivityStarter를 다시 보기로 하였다. 
<br />지난번에 ActivityStarter의 startActivity, startActivityUnchecked 메소드를 보고 블로그에 정리했던 내용을 참고하면서,
<br />주로 모르고 넘어갔던 부분들을 자세히 살펴보는 쪽으로 진행하고 있다.
<br />지난번에 startActivity 메소드를 볼때, ActivityStartInterceptor 라는 클래스를 사용하는 부분이 있었다.

~~~
mInterceptor.setStates(userId, realCallingPid, realCallingUid, startFlags, callingPackage);
mInterceptor.intercept(intent, rInfo, aInfo, resolvedType, inTask, callingPid, callingUid,
        options);
intent = mInterceptor.mIntent;
rInfo = mInterceptor.mRInfo;
aInfo = mInterceptor.mAInfo;
resolvedType = mInterceptor.mResolvedType;
inTask = mInterceptor.mInTask;
callingPid = mInterceptor.mCallingPid;
callingUid = mInterceptor.mCallingUid;
options = mInterceptor.mActivityOptions;
~~~

ActivityStartInterceptor의 setStates, intercept 메소드를 호출한 후 intercept 메소드의 호출에 parameter로 사용되었던 필드들의 값을 변경해준다.
ActivityStartInterceptor의 각 메소드는 다음과 같다.

~~~
void setStates(int userId, int realCallingPid, int realCallingUid, int startFlags,
        String callingPackage) {
    mRealCallingPid = realCallingPid;
    mRealCallingUid = realCallingUid;
    mUserId = userId;
    mStartFlags = startFlags;
    mCallingPackage = callingPackage;
}
~~~

~~~
void intercept(Intent intent, ResolveInfo rInfo, ActivityInfo aInfo, String resolvedType,
        TaskRecord inTask, int callingPid, int callingUid, ActivityOptions activityOptions) {
    mUserManager = UserManager.get(mService.mContext);
    mIntent = intent;
    mCallingPid = callingPid;
    mCallingUid = callingUid;
    mRInfo = rInfo;
    mAInfo = aInfo;
    mResolvedType = resolvedType;
    mInTask = inTask;
    mActivityOptions = activityOptions;
    if (interceptSuspendPackageIfNeed()) {
        // Skip the rest of interceptions as the package is suspended by device admin so
        // no user action can undo this.
        return;
    }
    if (interceptQuietProfileIfNeeded()) {
        // If work profile is turned off, skip the work challenge since the profile can only
        // be unlocked when profile's user is running.
        return;
    }
    interceptWorkProfileChallengeIfNeeded();
}
~~~

setState와 Intercept 모두 기본적으로는 parameter로 값을 전달받아 ActivityStartInterceptor의 각 필드의 값을 설정하는 정도의 역할을 수행한다.
<br />
<br />startActivity에서 위의 두 메소드를 수행한 뒤, 다시 ActivityStartInterceptor의 필드들을 가져온다. 즉, ActivityStartInterceptor는 
* * *
